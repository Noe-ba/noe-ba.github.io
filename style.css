/* ============================================
   STYLE MINIMALISTE - Mémoire Œdipe et la machine apprenante
   Design épuré, intellectuel, avec halo lumineux animé
   ============================================ */

/* === VARIABLES === */
:root {
    --bg-primary: #fafafa;
    --bg-secondary: rgba(255, 255, 255, 0.4);
    --text-primary: #1a1a1a;
    --text-secondary: #666666;
    --text-tertiary: #999999;
    --accent: #4a90e2;
    --accent-light: #6ba3e8;
    --border: #e8e8e8;
    --shadow: rgba(0, 0, 0, 0.04);
}

/* === RESET & BASE === */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'Helvetica Neue', Arial, sans-serif;
    font-size: 17px;
    line-height: 1.7;
    color: var(--text-primary);
    background: var(--bg-primary);
    font-weight: 400;
    position: relative;
    overflow-x: hidden;
}

/* === ARRIÈRE-PLAN ŒIL (page d'accueil uniquement) === */
.eye-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -2;
    opacity: 0.25;
    background-image: url('images/Pour_QR_code_optimized.webp');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    animation: eyeBreath 8s ease-in-out infinite;
}

@keyframes eyeBreath {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.02);
    }
}

/* === PUPILLE CLIQUABLE === */
.pupil-trigger {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
    z-index: 10;
    transition: all 0.4s ease;
}

.pupil-trigger::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(74, 144, 226, 0);
    transition: background 0.4s ease;
    pointer-events: none;
}

.pupil-trigger:hover::before {
    background: rgba(74, 144, 226, 0.02);
}

@keyframes pulse {
    0%, 100% {
        transform: translate(-50%, -50%) scale(1);
    }
    50% {
        transform: translate(-50%, -50%) scale(1.2);
    }
}

.pupil-trigger::after {
    content: '';
}

.pupil-trigger:hover::after {
    opacity: 0.8;
}

/* === TEXTE D'INVITATION === */
.click-invitation {
    text-align: center;
    font-size: 0.95rem;
    font-weight: 300;
    color: var(--text-tertiary);
    opacity: 0.5;
    letter-spacing: 0.1em;
    margin: 4rem auto 1.5rem;
    transition: opacity 0.4s ease;
}

body:hover .click-invitation {
    opacity: 0.8;
}


/* === HALO LUMINEUX ANIMÉ === */
body::before {
    content: '';
    position: fixed;
    top: -20%;
    right: -20%;
    width: 800px;
    height: 800px;
    background: radial-gradient(
        circle at center,
        rgba(255, 182, 193, 0.25) 0%,
        rgba(255, 160, 180, 0.18) 20%,
        rgba(147, 112, 219, 0.15) 40%,
        rgba(74, 144, 226, 0.12) 60%,
        transparent 80%
    );
    filter: blur(60px);
    animation: haloMove 25s ease-in-out infinite;
    pointer-events: none;
    z-index: -1;
    opacity: 0.8;
}

body::after {
    content: '';
    position: fixed;
    bottom: -30%;
    left: -30%;
    width: 700px;
    height: 700px;
    background: radial-gradient(
        circle at center,
        rgba(74, 144, 226, 0.2) 0%,
        rgba(107, 163, 232, 0.15) 30%,
        rgba(147, 112, 219, 0.1) 50%,
        transparent 75%
    );
    filter: blur(50px);
    animation: haloMoveAlt 30s ease-in-out infinite;
    pointer-events: none;
    z-index: -1;
    opacity: 0.7;
}

@keyframes haloMove {
    0%, 100% {
        transform: translate(0, 0) scale(1);
    }
    33% {
        transform: translate(-15%, 10%) scale(1.15);
    }
    66% {
        transform: translate(10%, -15%) scale(0.9);
    }
}

@keyframes haloMoveAlt {
    0%, 100% {
        transform: translate(0, 0) scale(1);
    }
    33% {
        transform: translate(12%, -8%) scale(1.1);
    }
    66% {
        transform: translate(-10%, 12%) scale(0.95);
    }
}

/* === CONTAINER === */
.container {
    max-width: 720px;
    margin: 0 auto;
    padding: 6rem 3rem;
}

/* === HEADER PRINCIPAL (Page d'accueil) === */
.main-header {
    text-align: center;
    margin-bottom: 8rem;
}

.hero-image {
    margin-bottom: 4rem;
    border-radius: 2px;
    overflow: hidden;
}

.hero-image img {
    width: 100%;
    height: auto;
    display: block;
}

.main-title {
    font-size: 2.8rem;
    font-weight: 300;
    line-height: 1.3;
    margin-bottom: 2rem;
    color: var(--text-primary);
    letter-spacing: -0.02em;
    text-align: center;
}

.subtitle {
    font-size: 1.1rem;
    font-weight: 400;
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 3rem;
    letter-spacing: 0.01em;
    text-align: center !important;
}

.meta-info {
    font-size: 0.95rem;
    color: var(--text-tertiary);
    line-height: 1.8;
    text-align: center;
}

.meta-info .author {
    font-weight: 500;
    color: var(--text-secondary);
    font-size: 1rem;
    margin-bottom: 0.5rem;
}

.meta-info .institution,
.meta-info .direction {
    margin: 0.3rem 0;
}

/* === SEPARATOR === */
.separator {
    width: 60px;
    height: 1px;
    background: var(--border);
    margin: 0 auto 5rem;
}

/* === SOMMAIRE === */
.sommaire {
    margin-bottom: 6rem;
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    transition: opacity 0.6s ease, max-height 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.sommaire.revealed {
    opacity: 1;
    max-height: 2000px;
}

.sommaire h2 {
    font-size: 1.3rem;
    font-weight: 500;
    margin-bottom: 3rem;
    text-align: center;
    color: var(--text-secondary);
    letter-spacing: 0.05em;
    text-transform: uppercase;
    font-size: 0.85rem;
}

.sommaire-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.sommaire-list li a {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    padding: 1.8rem 2rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 0;
    text-decoration: none;
    color: var(--text-primary);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
}

.sommaire-list li a::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 2px;
    height: 100%;
    background: var(--accent);
    transform: scaleY(0);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.sommaire-list li a:hover {
    background: var(--bg-secondary);
    border-color: var(--accent);
    box-shadow: 0 2px 12px var(--shadow);
}

.sommaire-list li a:hover::before {
    transform: scaleY(1);
}

.sommaire-list .arrow {
    font-size: 1.2rem;
    color: var(--accent);
    font-weight: 300;
}

.sommaire-list .number {
    font-size: 1.3rem;
    font-weight: 300;
    color: var(--text-tertiary);
    min-width: 30px;
}

.sommaire-list .title {
    font-size: 1.05rem;
    font-weight: 400;
    color: var(--text-primary);
}

/* === NAVIGATION (dans les pages de contenu) === */
.nav-top {
    margin-bottom: 4rem;
    text-align: center;
}

.nav-top a {
    color: var(--text-tertiary);
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 400;
    transition: color 0.3s ease;
    letter-spacing: 0.02em;
}

.nav-top a:hover {
    color: var(--accent);
}

/* === TITRES === */
h1, h2, h3, h4, h5, h6 {
    font-weight: 400;
    line-height: 1.4;
    margin-bottom: 1.5rem;
    color: var(--text-primary);
    letter-spacing: -0.01em;
}

h1 {
    font-size: 2.2rem;
    margin-bottom: 2.5rem;
    font-weight: 300;
    text-align: left;
}

.main-header h1 {
    text-align: center !important;
}

h2 {
    font-size: 1.6rem;
    margin-top: 4rem;
    font-weight: 400;
}

h3 {
    font-size: 1.3rem;
    margin-top: 3rem;
    font-weight: 400;
}

/* === PARAGRAPHES === */
p {
    margin-bottom: 1.5rem;
    color: var(--text-secondary);
}

/* === LIENS === */
a {
    color: var(--accent);
    text-decoration: none;
    transition: color 0.3s ease;
    border-bottom: 1px solid transparent;
}

a:hover {
    color: var(--accent-light);
    border-bottom-color: var(--accent-light);
}

/* === EMPHASES === */
em, i {
    font-style: italic;
    color: var(--text-primary);
}

strong, b {
    font-weight: 500;
    color: var(--text-primary);
}

/* === CITATIONS === */
blockquote {
    margin: 3rem 0;
    padding: 2rem 0;
    border-left: 2px solid var(--border);
    padding-left: 2rem;
    font-style: normal;
    color: var(--text-secondary);
    font-size: 1.05rem;
}

blockquote em,
blockquote i {
    font-style: italic;
}

/* === IMAGES === */
.content-image {
    margin: 4rem 0;
}

.content-image img {
    width: 100%;
    height: auto;
    border-radius: 0;
    display: block;
}

.content-image figcaption {
    margin-top: 1rem;
    font-size: 0.9rem;
    color: var(--text-tertiary);
    text-align: center;
    font-style: italic;
}

/* === NOTES DE BAS DE PAGE (cliquables) === */
.note-ref {
    display: inline-block;
    color: var(--accent);
    text-decoration: none;
    font-size: 0.85em;
    vertical-align: super;
    font-weight: 500;
    cursor: pointer;
    transition: color 0.2s ease;
}

.note-ref:hover {
    color: var(--accent-light);
}

/* Popup note */
.note-popup {
    display: none;
    position: fixed;
    bottom: 3rem;
    left: 50%;
    transform: translateX(-50%);
    max-width: 600px;
    width: 90%;
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 0;
    padding: 2rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    z-index: 1000;
    animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.note-popup.active {
    display: block;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

.note-popup-content {
    font-size: 0.95rem;
    line-height: 1.6;
    color: var(--text-secondary);
}

.note-popup-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    color: var(--text-tertiary);
    font-size: 1.5rem;
    cursor: pointer;
    transition: color 0.2s ease;
    font-weight: 300;
}

.note-popup-close:hover {
    color: var(--text-primary);
}

/* === NAVIGATION PARTIE (précédent/suivant) === */
.nav-partie {
    display: flex;
    justify-content: space-between;
    gap: 1.5rem;
    margin: 6rem 0 3rem;
    padding-top: 4rem;
    border-top: 1px solid var(--border);
}

.nav-partie a {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    padding: 1.2rem 2rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 0;
    text-decoration: none;
    color: var(--text-primary);
    font-weight: 400;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.nav-partie a:hover {
    background: var(--bg-secondary);
    border-color: var(--accent);
    box-shadow: 0 2px 12px var(--shadow);
}

.nav-partie .prev::before {
    content: "←";
    font-size: 1.2rem;
    color: var(--accent);
    font-weight: 300;
}

.nav-partie .next::after {
    content: "→";
    font-size: 1.2rem;
    color: var(--accent);
    font-weight: 300;
}

/* === FOOTER === */
.main-footer {
    margin-top: 6rem;
    padding-top: 3rem;
    border-top: 1px solid var(--border);
    text-align: center;
    font-size: 0.85rem;
    color: var(--text-tertiary);
}

/* === BIBLIOGRAPHIE === */
.biblio-section {
    margin-bottom: 4rem;
}

.biblio-section h2 {
    font-size: 1.3rem;
    margin-bottom: 2rem;
    color: var(--text-primary);
    font-weight: 400;
}

.biblio-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 1.2rem;
}

.biblio-list li {
    padding-left: 1.5rem;
    position: relative;
    line-height: 1.7;
    color: var(--text-secondary);
}

.biblio-list li::before {
    content: "—";
    position: absolute;
    left: 0;
    color: var(--accent);
    font-weight: 300;
}

/* === ACCORDÉON GROTHENDIECK (input/output) === */
.grothendieck-accordion {
    margin: 4rem 0;
    border: 1px solid var(--border);
    border-radius: 0;
    overflow: hidden;
    background: var(--bg-secondary);
}

.grothendieck-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    cursor: pointer;
    transition: background 0.3s ease;
    user-select: none;
}

.grothendieck-header:hover {
    background: var(--bg-primary);
}

.grothendieck-label {
    font-size: 1rem;
    font-weight: 400;
    color: var(--text-secondary);
    font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
    letter-spacing: 0.02em;
}

.grothendieck-icon {
    font-size: 1.3rem;
    color: var(--accent);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 300;
}

.grothendieck-accordion.active .grothendieck-icon {
    transform: rotate(180deg);
}

.grothendieck-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.grothendieck-accordion.active .grothendieck-content {
    max-height: 2000px;
}

.grothendieck-text {
    padding: 2rem;
    line-height: 1.8;
    color: var(--text-secondary);
    font-style: italic;
    border-top: 1px solid var(--border);
}

.grothendieck-text footer {
    margin-top: 1.5rem;
    font-style: normal;
    text-align: right;
    color: var(--text-tertiary);
    font-size: 0.9rem;
}

/* === CODE (pour les exemples techniques si besoin) === */
code {
    background: var(--bg-primary);
    padding: 0.2rem 0.5rem;
    border-radius: 2px;
    font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
    font-size: 0.9em;
    color: var(--accent);
}

pre {
    background: var(--bg-primary);
    padding: 2rem;
    border-radius: 0;
    overflow-x: auto;
    margin: 3rem 0;
    border: 1px solid var(--border);
}

pre code {
    background: none;
    padding: 0;
}

/* === LISTES === */
ul, ol {
    margin: 2rem 0;
    padding-left: 2rem;
}

ul li, ol li {
    margin-bottom: 0.8rem;
    line-height: 1.7;
    color: var(--text-secondary);
}

/* === SÉPARATEUR DANS LE TEXTE === */
hr {
    border: none;
    height: 1px;
    background: var(--border);
    margin: 4rem 0;
}

/* === RESPONSIVE === */
@media (max-width: 768px) {
    body {
        font-size: 16px;
    }
    
    .container {
        padding: 4rem 2rem;
    }
    
    .main-title {
        font-size: 2rem;
    }
    
    .subtitle {
        font-size: 1rem;
    }
    
    h1 {
        font-size: 1.8rem;
    }
    
    h2 {
        font-size: 1.4rem;
    }
    
    .sommaire-list li a {
        padding: 1.5rem 1.5rem;
    }
    
    .nav-partie {
        flex-direction: column;
    }
    
    .note-popup {
        width: 95%;
        padding: 1.5rem;
    }
    
    body::before {
        animation-duration: 35s;
        width: 600px;
        height: 600px;
    }
    
    body::after {
        animation-duration: 40s;
        width: 500px;
        height: 500px;
    }
}

/* === MOBILE UNIQUEMENT (pas tablette) === */
@media (max-width: 480px) {
    /* Décaler l'œil vers la gauche sur mobile UNIQUEMENT */
    .eye-background {
        background-position: 20% center;
    }
}

/* === FORCER LES COULEURS EN MODE CLAIR (éviter le bug visuel sur mobile) === */
/* Note: Ces règles corrigent un bug d'affichage où le texte apparaît grisé en mode clair sur mobile */
@media (max-width: 768px) {
    /* === FOND ET TEXTE GÉNÉRAL === */
    body:not(.dark-mode) {
        background: #fafafa !important;
        color: #1a1a1a !important;
    }
    
    /* === TITRES === */
    body:not(.dark-mode) .main-title,
    body:not(.dark-mode) h1,
    body:not(.dark-mode) h2,
    body:not(.dark-mode) h3 {
        color: #1a1a1a !important;
    }

    /* === TEXTES === */
    body:not(.dark-mode) .subtitle,
    body:not(.dark-mode) .meta-info,
    body:not(.dark-mode) .meta-info *,
    body:not(.dark-mode) p {
        color: #666666 !important;
    }
    
    body:not(.dark-mode) .author {
        color: #666666 !important;
    }
    
    body:not(.dark-mode) .institution,
    body:not(.dark-mode) .direction {
        color: #999999 !important;
    }

    body:not(.dark-mode) .click-invitation {
        color: #999999 !important;
    }
    
    /* === SOMMAIRE EN MODE CLAIR === */
    body:not(.dark-mode) .sommaire h2 {
        color: #666666 !important;
    }
    
    body:not(.dark-mode) .sommaire-list li a {
        background: rgba(255, 255, 255, 0.4) !important;
        border-color: #e8e8e8 !important;
        color: #1a1a1a !important;
    }
    
    body:not(.dark-mode) .sommaire-list .title {
        color: #1a1a1a !important;
    }
    
    body:not(.dark-mode) .sommaire-list .number {
        color: #999999 !important;
    }
    
    body:not(.dark-mode) .sommaire-list .arrow {
        color: #4a90e2 !important;
    }
    
    body:not(.dark-mode) .sommaire-list li a:hover {
        background: rgba(255, 255, 255, 0.6) !important;
        border-color: #4a90e2 !important;
    }
}

/* === AMÉLIORATION DE LA LISIBILITÉ === */
::selection {
    background: rgba(74, 144, 226, 0.15);
    color: var(--text-primary);
}

/* === TRANSITIONS FLUIDES === */
* {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}
/* ========================================
   MODE SOMBRE - CSS À AJOUTER À style.css
   ======================================== */

/* === VARIABLES POUR MODE SOMBRE === */
:root {
    --bg-light: #fafafa;
    --bg-secondary-light: #ffffff;
    --text-primary-light: #1a1a1a;
    --text-secondary-light: #4a5568;
    --text-tertiary-light: #718096;
    --border-light: rgba(74, 144, 226, 0.15);
    --accent-light: #4a90e2;
    --shadow-light: rgba(0, 0, 0, 0.1);
    
    --bg-dark: #0f1729;
    --bg-secondary-dark: rgba(30, 41, 59, 0.6);
    --text-primary-dark: #e5e7eb;
    --text-secondary-dark: #cbd5e1;
    --text-tertiary-dark: #94a3b8;
    --border-dark: rgba(74, 144, 226, 0.25);
    --accent-dark: #6ba3e8;
    --shadow-dark: rgba(0, 0, 0, 0.3);
}

/* === MODE SOMBRE ACTIF === */
body.dark-mode {
    background: var(--bg-dark);
    color: var(--text-primary-dark);
}

body.dark-mode .main-title,
body.dark-mode h1 {
    color: var(--text-primary-dark);
}

body.dark-mode .subtitle,
body.dark-mode h2 {
    color: var(--text-secondary-dark);
}

body.dark-mode .meta-info,
body.dark-mode .author,
body.dark-mode .institution,
body.dark-mode .direction,
body.dark-mode p {
    color: var(--text-secondary-dark);
}

body.dark-mode .click-invitation {
    color: var(--text-tertiary-dark);
}

body.dark-mode .separator {
    background: var(--border-dark);
}

body.dark-mode a {
    color: var(--accent-dark);
}

body.dark-mode a:hover {
    color: #8bb9ed;
}

body.dark-mode em,
body.dark-mode i {
    color: var(--text-primary-dark);
}

body.dark-mode strong,
body.dark-mode b {
    color: var(--text-primary-dark);
}

body.dark-mode blockquote {
    color: var(--text-secondary-dark);
    border-left-color: var(--border-dark);
}

body.dark-mode code,
body.dark-mode pre {
    background: rgba(0, 0, 0, 0.3);
    color: var(--text-primary-dark);
}

body.dark-mode figcaption {
    color: var(--text-tertiary-dark);
}

/* Sommaire en mode sombre */
body.dark-mode .sommaire-list li a {
    background: var(--bg-secondary-dark);
    border-color: var(--border-dark);
    color: var(--text-primary-dark);
}

body.dark-mode .sommaire-list li a:hover {
    background: rgba(30, 41, 59, 0.8);
    border-color: var(--accent-dark);
    box-shadow: 0 2px 12px var(--shadow-dark);
}

body.dark-mode .sommaire-list .title {
    color: var(--text-primary-dark);
}

body.dark-mode .sommaire-list .number {
    color: var(--text-tertiary-dark);
}

body.dark-mode .sommaire-list .arrow {
    color: var(--accent-dark);
}

body.dark-mode .sommaire h2 {
    color: var(--text-secondary-dark);
}

/* FORÇAGE SOMMAIRE MODE SOMBRE SUR MOBILE (éviter bug lors du toggle) */
@media (max-width: 768px) {
    body.dark-mode .sommaire h2 {
        color: #cbd5e1 !important;
    }
    
    body.dark-mode .sommaire-list li a {
        background: rgba(30, 41, 59, 0.6) !important;
        border-color: rgba(74, 144, 226, 0.25) !important;
        color: #e5e7eb !important;
    }
    
    body.dark-mode .sommaire-list .title {
        color: #e5e7eb !important;
    }
    
    body.dark-mode .sommaire-list .number {
        color: #94a3b8 !important;
    }
    
    body.dark-mode .sommaire-list .arrow {
        color: #6ba3e8 !important;
    }
    
    body.dark-mode .sommaire-list li a:hover {
        background: rgba(30, 41, 59, 0.8) !important;
        border-color: #6ba3e8 !important;
    }
}

/* Notes de bas de page en mode sombre */
body.dark-mode .note-popup {
    background: rgba(15, 23, 42, 0.98);
    border-color: var(--border-dark);
}

body.dark-mode .note-popup-content {
    color: var(--text-primary-dark);
}

body.dark-mode .note-popup-close {
    color: var(--text-primary-dark);
    background: rgba(255, 255, 255, 0.1);
}

body.dark-mode .note-popup-close:hover {
    background: rgba(255, 255, 255, 0.2);
}

body.dark-mode .note-ref {
    color: var(--accent-dark);
    background: rgba(74, 144, 226, 0.1);
}

body.dark-mode .note-ref:hover {
    background: rgba(74, 144, 226, 0.2);
}

/* Navigation entre parties en mode sombre */
body.dark-mode .nav-partie a,
body.dark-mode .nav-top a {
    background: var(--bg-secondary-dark);
    border-color: var(--border-dark);
    color: var(--text-primary-dark);
}

body.dark-mode .nav-partie a:hover,
body.dark-mode .nav-top a:hover {
    background: rgba(30, 41, 59, 0.8);
    border-color: var(--accent-dark);
    color: var(--accent-dark);
}

/* Inputs et outputs en mode sombre */
body.dark-mode input,
body.dark-mode textarea,
body.dark-mode select,
body.dark-mode .input-section,
body.dark-mode .output-section {
    background: transparent !important;
    border-color: var(--border-dark) !important;
    color: #e5e7eb !important;
}

body.dark-mode input:focus,
body.dark-mode textarea:focus,
body.dark-mode select:focus {
    border-color: var(--accent-dark) !important;
    background: transparent !important;
}

body.dark-mode input::placeholder,
body.dark-mode textarea::placeholder {
    color: var(--text-tertiary-dark) !important;
}

body.dark-mode .input-label,
body.dark-mode .output-label {
    color: var(--text-secondary-dark) !important;
}

/* Forcer la couleur du texte dans les zones de texte - même couleur que le texte normal */
body.dark-mode .output-section,
body.dark-mode .output-section *,
body.dark-mode .input-section,
body.dark-mode .input-section * {
    color: #e5e7eb !important;
    background: transparent !important;
}

/* Classes spécifiques pour entrée/sortie */
body.dark-mode .terminal-output,
body.dark-mode .terminal-input,
body.dark-mode .console-output,
body.dark-mode .code-output {
    background: transparent !important;
    color: #e5e7eb !important;
    border-color: var(--border-dark) !important;
}

/* Enlever tout effet de survol sur les zones input/output */
body.dark-mode .input-section:hover,
body.dark-mode .output-section:hover,
body.dark-mode .input-section:hover *,
body.dark-mode .output-section:hover * {
    background: transparent !important;
    color: #e5e7eb !important;
}

/* Accordéon Grothendieck (input/output) en mode sombre */
body.dark-mode .grothendieck-accordion {
    background: transparent;
    border-color: var(--border-dark);
}

body.dark-mode .grothendieck-header {
    background: transparent;
}

body.dark-mode .grothendieck-header:hover {
    background: rgba(30, 41, 59, 0.3);
}

body.dark-mode .grothendieck-label {
    color: var(--text-secondary-dark) !important;
}

body.dark-mode .grothendieck-icon {
    color: var(--accent-dark);
}

body.dark-mode .grothendieck-text {
    color: var(--text-secondary-dark) !important;
    border-top-color: var(--border-dark);
    background: transparent !important;
}

body.dark-mode .grothendieck-text footer {
    color: var(--text-tertiary-dark) !important;
}

body.dark-mode button:not(.dark-mode-toggle):not(.note-popup-close) {
    background: rgba(30, 41, 59, 0.6);
    border-color: var(--border-dark);
    color: var(--text-primary-dark);
}

body.dark-mode button:not(.dark-mode-toggle):not(.note-popup-close):hover {
    background: rgba(30, 41, 59, 0.8);
    border-color: var(--accent-dark);
}

/* Footer en mode sombre */
body.dark-mode .main-footer {
    color: var(--text-tertiary-dark);
}

body.dark-mode .main-footer a {
    color: var(--accent-dark);
}

/* Ajuster les halos pour le mode sombre */
body.dark-mode::before {
    opacity: 0.4;
}

body.dark-mode::after {
    opacity: 0.3;
}

/* Ajuster l'œil en mode sombre */
body.dark-mode .eye-background {
    opacity: 0.15;
}

/* === BOUTON TOGGLE MODE SOMBRE === */
.dark-mode-toggle {
    position: fixed;
    top: 2rem;
    right: 2rem;
    width: 35px;
    height: 35px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(74, 144, 226, 0.2);
    border-radius: 50%;
    cursor: pointer;
    z-index: 1000;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
}

.dark-mode-toggle:hover {
    background: rgba(74, 144, 226, 0.15);
    border-color: rgba(74, 144, 226, 0.4);
    transform: scale(1.05);
}

.dark-mode-toggle:active {
    transform: scale(0.95);
}

/* Icônes soleil et lune */
.dark-mode-toggle .icon-sun,
.dark-mode-toggle .icon-moon {
    transition: opacity 0.3s ease, transform 0.3s ease;
    position: absolute;
}

.dark-mode-toggle .icon-sun {
    opacity: 1;
}

.dark-mode-toggle .icon-moon {
    opacity: 0;
    transform: rotate(180deg);
}

body.dark-mode .dark-mode-toggle {
    background: rgba(0, 0, 0, 0.3);
    border-color: rgba(74, 144, 226, 0.3);
}

body.dark-mode .dark-mode-toggle .icon-sun {
    opacity: 0;
    transform: rotate(180deg);
}

body.dark-mode .dark-mode-toggle .icon-moon {
    opacity: 1;
    transform: rotate(0deg);
}

/* Responsive pour mobile */
@media (max-width: 768px) {
    .dark-mode-toggle {
        top: 1rem;
        right: 1rem;
        width: 32px;
        height: 32px;
        font-size: 0.9rem;
    }
}

/* === TRANSITION DOUCE === */
body,
.main-title,
.subtitle,
.meta-info,
a,
.separator,
.eye-background,
body::before,
body::after {
    transition: background-color 0.3s ease, 
                color 0.3s ease, 
                opacity 0.3s ease, 
                border-color 0.3s ease;
}


/* ============================================================
   JUSTIFICATION DU TEXTE - SPÉCIFICITÉ MAXIMALE
   ============================================================ */

/* Justifier tous les paragraphes */
.container p:not(.subtitle):not(.click-invitation):not(.author):not(.institution):not(.direction):not(.main-footer p) {    text-align: justify;
    text-justify: inter-word;
    hyphens: auto;
    -webkit-hyphens: auto;
    -moz-hyphens: auto;
    -ms-hyphens: auto;
    word-spacing: -0.05em;
    letter-spacing: 0.01em;
    text-align-last: left;
    orphans: 2;
    widows: 2;
    overflow-wrap: break-word;
    word-wrap: break-word;
}

.main-footer p {
    text-align: center !important;
}
/* EXCEPTIONS : Spécificité PLUS HAUTE */
.main-header,
.main-header *,
.main-header h1,
.main-header .main-title,
.main-header p,
.main-header .subtitle,
.main-header .meta-info,
.main-header .author,
.main-header .institution,
.main-header .direction,
.container p.subtitle,
.container p.click-invitation,
.container .meta-info p,
.container .main-footer p,
.container .sommaire p,
.container .sommaire-list p {
    text-align: center !important;
    hyphens: none !important;
    -webkit-hyphens: none !important;
    word-spacing: normal !important;
    letter-spacing: normal !important;
}

.container .main-title {
    text-align: center !important;
    hyphens: none !important;
}

/* Empêcher la justification dans le sommaire */
.sommaire h2 {
    text-align: center !important;
    hyphens: none !important;
    -webkit-hyphens: none !important;
}

.sommaire-list,
.sommaire-list * {
    text-align: left !important;
    hyphens: none !important;
    -webkit-hyphens: none !important;
}

/* Titres : à gauche (sauf dans le header de la page d'accueil) */
.container > article h1,
.container > article h2,
.container > article h3,
.container > article h4,
.container > article h5,
.container > article h6 {
    text-align: left;
    hyphens: none;
}

/* Listes : à gauche */
ul, ol, li {
    text-align: left;
    hyphens: none;
}

/* Citations : justifiées */
blockquote {
    text-align: justify;
    hyphens: auto;
    -webkit-hyphens: auto;
}

/* Notes de bas de page : justifiées */
.note-popup-content {
    text-align: justify;
    hyphens: auto;
    -webkit-hyphens: auto;
}

/* Navigation */
.nav-top {
    text-align: center;
}

.nav-partie {
    text-align: left;
}

/* Qualité typographique */
body {
    text-rendering: optimizeLegibility;
}

/* Mobile */
@media (max-width: 480px) {
    .container p.subtitle,
    .container p.click-invitation,
    .container .meta-info p,
    .container .main-footer p {
        text-align: center !important;
    }
    
    .container .main-title {
        text-align: center !important;
    }
    
    .container p {
        text-align: justify;
    }
}
/* === FORÇAGE ULTIME DU CENTRAGE PAGE D'ACCUEIL === */
.main-header .main-title,
.main-header h1.main-title,
h1.main-title {
    text-align: center !important;
}

.main-header .subtitle,
.main-header p.subtitle,
p.subtitle {
    text-align: center !important;
}

.main-header .meta-info,
.meta-info {
    text-align: center !important;
}

.main-header .meta-info p,
.meta-info .author,
.meta-info .institution,
.meta-info .direction {
    text-align: center !important;
}

p.click-invitation,
.click-invitation {
    text-align: center !important;
}
<style>
/* === IMAGES AU SURVOL === */
.image-hover {
    position: relative;
    color: var(--accent) !important;
    cursor: help;
    border-bottom: 2px solid var(--accent) !important;
    text-decoration: none !important;
    display: inline;
    font-weight: 500;
}

.container .image-hover {
    color: var(--accent) !important;
}

.image-hover em,
.image-hover i {
    color: var(--accent) !important;
    border-bottom: inherit;
}

.image-hover:hover {
    color: var(--accent-light) !important;
    border-bottom-color: var(--accent-light) !important;
}

.image-hover-popup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-width: 500px;
    width: 90%;
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 0;
    padding: 0;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    z-index: 2000;
    animation: imagePopup 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.image-hover:hover .image-hover-popup {
    display: block;
}

@keyframes imagePopup {
    from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
}

.image-hover-popup img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 0;
}

.image-hover-caption {
    padding: 1rem 1.5rem;
    font-size: 0.9rem;
    color: var(--text-secondary);
    line-height: 1.5;
    font-style: normal;
    text-align: center;
}

.image-hover-caption em,
.image-hover-caption i {
    font-style: italic;
}

/* Mode sombre */
body.dark-mode .image-hover-popup {
    background: rgba(15, 23, 42, 0.98);
    border-color: var(--border-dark);
}

body.dark-mode .image-hover-caption {
    color: var(--text-secondary-dark);
}
</style>

/* === FIX BUG MOBILE : Empêcher la superposition lors du changement de mode === */
@media (max-width: 768px) {
    /* Forcer la transition instantanée sur mobile pour éviter les bugs */
    body.dark-mode .note-popup,
    body:not(.dark-mode) .note-popup,
    body.dark-mode .grothendieck-accordion,
    body:not(.dark-mode) .grothendieck-accordion,
    body.dark-mode .sommaire,
    body:not(.dark-mode) .sommaire {
        transition: all 0.1s ease !important;
    }
    
    /* S'assurer que les éléments cachés restent bien cachés */
    .note-popup:not(.active),
    .grothendieck-accordion:not(.active) .grothendieck-content {
        display: none !important;
        opacity: 0 !important;
        visibility: hidden !important;
    }
}
